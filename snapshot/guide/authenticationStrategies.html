<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>4 Authentication Strategies 1.1.1.BUILD-SNAPSHOT</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Micronaut Security
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/introduction.html"><strong>1</strong><span>Introduction</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/authenticationProviders.html"><strong>2</strong><span>Authentication Providers</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/securityRule.html"><strong>3</strong><span>Security Rules</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/authenticationStrategies.html"><strong>4</strong><span>Authentication Strategies</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/rejection.html"><strong>5</strong><span>Rejection Handling</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/tokenPropagation.html"><strong>6</strong><span>Token Propagation</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/endpoints.html"><strong>7</strong><span>Built-In Security Controllers</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/retrievingAuthenticatedUser.html"><strong>8</strong><span>Retrieve the authenticated user</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/securityEvents.html"><strong>9</strong><span>Security Events</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/securityRule.html">&lt;&lt; <strong>3</strong><span>Security Rules</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/rejection.html"><strong>5</strong><span>Rejection Handling</span> >></a></div>
                


                <div class="project">
                    <h1>4 Authentication Strategies</h1>

                    <p><strong>Version:</strong> 1.1.1.BUILD-SNAPSHOT</p>
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#basicAuth"><strong>4.1</strong><span>Basic Auth</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#session"><strong>4.2</strong><span>Session Authentication</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#jwt"><strong>4.3</strong><span>JSON Web Token</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#reader"><strong>4.3.1</strong><span>Reading JWT Token</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:20px"><a href="#bearerToken"><strong>4.3.1.1</strong><span>Bearer Token Reader</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:20px"><a href="#cookieToken"><strong>4.3.1.2</strong><span>Cookie Token Reader</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#jwtGenerator"><strong>4.3.2</strong><span>JWT Token Generation</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:20px"><a href="#jwtGeneratorSignature"><strong>4.3.2.1</strong><span>JWT Signature</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:20px"><a href="#jwtGeneratorEncryption"><strong>4.3.2.2</strong><span>Encrypted JWTs</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#jwtValidation"><strong>4.3.3</strong><span>JWT Token Validation</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:20px"><a href="#jwks"><strong>4.3.3.1</strong><span>Validation with remote JWKS</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#claimsGeneration"><strong>4.3.4</strong><span>Claims Generation</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#render"><strong>4.3.5</strong><span>Token Render</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#ldap"><strong>4.4</strong><span>LDAP Authentication</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#configuration"><strong>4.4.1</strong><span>Configuration</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#extending"><strong>4.4.2</strong><span>Extending Default Behavior</span></a>
                    </div>
                    
                </div>
                

                

<h1 id="authenticationStrategies">4 Authentication Strategies</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/master/src/main/docs/guide/authenticationStrategies.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>





<h2 id="basicAuth">4.1 Basic Auth</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/master/src/main/docs/guide/authenticationStrategies/basicAuth.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Out-of-the-box, Micronaut supports <a href="https://tools.ietf.org/html/rfc7617">RFC7617</a> which defines the "Basic" Hypertext Transfer Protocol (HTTP) authentication scheme, which transmits credentials as user-id/password pairs, encoded using Base64.</p>
</div>
<div class="paragraph">
<p>Once you enable Micronaut security, Basic Auth is enabled by default.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">Unresolved directive in &lt;stdin&gt; - include::{testssecurity}/security/token/basicauth/BasicAuthSpec.groovy[tag=yamlconfig,indent=0]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following sequence illustrates the authentication flow:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/basicauth.svg" alt="basicauth">
</div>
</div>
<div class="paragraph">
<p>Below is a sample of a cURL command using basic auth:</p>
</div>
<div class="listingblock">
<div class="title">cURL command using Basic Auth</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl "http://localhost:8080/info" \
     -u 'user:password'</code></pre>
</div>
</div>
<div class="paragraph">
<p>After credentials are read from the HTTP Header, they are feed into an <a href="../api/io/micronaut/security/authentication/Authenticator.html">Authenticator</a>
which attempts to validate them.</p>
</div>
<div class="paragraph">
<p>The code snippet below illustrates how to send credentials using the <code>basicAuth</code> method from <a href="../api/io/micronaut/http/MutableHttpRequest.html">MutableHttpRequest</a> method:</p>
</div>
<div class="listingblock">
<div class="title">Accessing a protected resource using an Authorization request header</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">Unresolved directive in &lt;stdin&gt; - include::http-client/src/test/groovy/io/micronaut/http/client/BasicAuthSpec.groovy[tag=basicAuth, indent=0]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following configuration properties are available to customize basic authentication behaviour:</p>
</div>
<div class="paragraph">
<p>Unresolved directive in &lt;stdin&gt; - include::/home/travis/build/micronaut-projects/micronaut-security/build/generated/configurationProperties/io.micronaut.security.token.basicauth.BasicAuthTokenReaderConfigurationProperties.adoc[]</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Read the <a href="http://guides.micronaut.io/micronaut-security-basicauth/guide/index.html">Basic Authentication Micronaut Guide</a> to learn more.
</td>
</tr>
</table>
</div>


<h2 id="session">4.2 Session Authentication</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/master/src/main/docs/guide/authenticationStrategies/session.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports Session based authentication.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, supply either the <code>security-session</code> feature to configure session security in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features security-session</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To use the Micronaut&#8217;s session based authentication capabilities you must have the <code>security-session</code> dependency on your classpath. For example in <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">annotationProcessor "io.micronaut:micronaut-security"
compile "io.micronaut:micronaut-security-session"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following sequence illustrates the authentication flow:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/sesssion_based_auth.svg" alt="sesssion based auth">
</div>
</div>
<div class="paragraph">
<p>The following configuration properties are available to customize session based authentication behaviour:</p>
</div>
<div class="paragraph">
<p>Unresolved directive in &lt;stdin&gt; - include::/home/travis/build/micronaut-projects/micronaut-security/build/generated/configurationProperties/io.micronaut.security.session.SecuritySessionConfigurationProperties.adoc[]</p>
</div>
<div class="sect1">
<h2 id="_example_of_session_based_authentication_configuration">Example of Session-Based Authentication configuration</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">Unresolved directive in &lt;stdin&gt; - include::{testssecuritysession}/security/session/SessionAuthenticationSpec.groovy[tag=yamlconfig,indent=0]</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Read the <a href="http://guides.micronaut.io/micronaut-security-session/guide/index.html">Session-Based Authentication Micronaut Guide</a> to learn more.
</td>
</tr>
</table>
</div>
</div>
</div>


<h2 id="jwt">4.3 JSON Web Token</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/master/src/main/docs/guide/authenticationStrategies/jwt.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The following configuration properties are available to customize token based authentication:</p>
</div>
<div class="paragraph">
<p>Unresolved directive in &lt;stdin&gt; - include::/home/travis/build/micronaut-projects/micronaut-security/build/generated/configurationProperties/io.micronaut.security.token.config.TokenConfigurationProperties.adoc[]</p>
</div>
<div class="paragraph">
<p>Micronaut ships with security capabilities based on <a href="https://jwt.io/">Json Web Token (JWT)</a>.
JWT is an <a href="https://tools.ietf.org/html/rfc7519">IETF standard</a> which defines a secure way to encapsulate arbitrary data that can be sent over unsecure URL’s.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, supply the <code>security-jwt</code> feature to configure JWT support in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features security-jwt</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To use the Micronaut&#8217;s JWT based authentication capabilities you must have the <code>security-jwt</code> dependency on your classpath. For example in <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">annotationProcessor "io.micronaut:micronaut-security"
compile "io.micronaut:micronaut-security-jwt"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following configuration properties are available to customize JWT based authentication behaviour:</p>
</div>
<div class="paragraph">
<p>Unresolved directive in &lt;stdin&gt; - include::/home/travis/build/micronaut-projects/micronaut-security/build/generated/configurationProperties/io.micronaut.security.token.jwt.config.JwtConfigurationProperties.adoc[]</p>
</div>
<div class="sect1">
<h2 id="_what_does_a_jwt_look_like">What does a JWT look like?</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="../img/jwt.png" alt="jwt">
</div>
</div>
<div class="sect2">
<h3 id="_header">Header</h3>
<div class="paragraph">
<p>A base64-encoded JSON like:</p>
</div>
<div class="listingblock">
<div class="title">JWT header</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "alg": "HS256",
    "typ": "JWT"
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_claims">Claims</h3>
<div class="paragraph">
<p>A base64-encoded JSON like:</p>
</div>
<div class="listingblock">
<div class="title">JWT claims</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "exp": 1422990129,
    "sub": "jimi",
    "roles": [
        "ROLE_ADMIN",
        "ROLE_USER"
    ],
    "iat": 1422986529
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_signature">Signature</h3>
<div class="paragraph">
<p>Depends on the algorithm specified on the header, it can be a digital signature of the base64-encoded header and claims, or an encryption of them.</p>
</div>
</div>
</div>
</div>


<h2 id="reader">4.3.1 Reading JWT Token</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/master/src/main/docs/guide/authenticationStrategies/jwt/reader.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>





<h2 id="bearerToken">4.3.1.1 Bearer Token Reader</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/master/src/main/docs/guide/authenticationStrategies/jwt/reader/bearerToken.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports the <a href="https://tools.ietf.org/html/rfc6750">RFC 6750 Bearer Token</a> specification for transmitting JWT tokens. The following sequence illustrates the RFC 6750 authentication flow:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/jwt-bearer-token.svg" alt="jwt bearer token">
</div>
</div>
<div class="paragraph">
<p>The following configuration properties are available to customize how the Bearer Token will be read:</p>
</div>
<div class="paragraph">
<p>Unresolved directive in &lt;stdin&gt; - include::/home/travis/build/micronaut-projects/micronaut-security/build/generated/configurationProperties/io.micronaut.security.token.jwt.bearer.BearerTokenConfigurationProperties.adoc[]</p>
</div>
<div class="sect1">
<h2 id="_sending_tokens_in_the_request">Sending tokens in the request</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The code snippet below illustrates how to send a JWT token in the <code>Authorization</code> request header, using the <code>bearerAuth</code> method from <a href="../api/io/micronaut/http/MutableHttpRequest.html">MutableHttpRequest</a> method:</p>
</div>
<div class="listingblock">
<div class="title">Accessing a protected resource using an Authorization request header</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">String accessToken = rsp.body().accessToken
List&lt;Book&gt; books = gatewayClient.toBlocking().retrieve(HttpRequest.GET("/api/gateway")
        .bearerAuth(accessToken), Argument.listOf(Book))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example of HTTP GET request using Authorization request header</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">GET /protectedResource HTTP/1.1
Host: micronaut.example`
Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJleHAiOjE0MjI5OTU5MjIsInN1YiI6ImppbWkiLCJyb2xlcyI6WyJST0xFX0FETUlOIiwiUk9MRV9VU0VSIl0sImlhdCI6MTQyMjk5MjMyMn0.rA7A2Gwt14LaYMpxNRtrCdO24RGrfHtZXY9fIjV8x8o</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Check out the <a href="http://guides.micronaut.io/micronaut-security-jwt/guide/index.html">Micronaut JWT Authentication guide</a> for a tutorial on Micronaut&#8217;s JWT support.
</td>
</tr>
</table>
</div>
</div>
</div>


<h2 id="cookieToken">4.3.1.2 Cookie Token Reader</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/master/src/main/docs/guide/authenticationStrategies/jwt/reader/cookieToken.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can send/read a JWT token from a Cookie too.</p>
</div>
<div class="paragraph">
<p>The following sequence illustrates the authentication flow:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/jwt-cookie.svg" alt="jwt cookie">
</div>
</div>
<div class="paragraph">
<p>Reading tokens from Cookies is disabled by default. Note that using JWT tokens from cookies requires JWT Authentication to be enabled.</p>
</div>
<div class="paragraph">
<p>Unresolved directive in &lt;stdin&gt; - include::/home/travis/build/micronaut-projects/micronaut-security/build/generated/configurationProperties/io.micronaut.security.token.jwt.cookie.JwtCookieConfigurationProperties.adoc[]</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Read the <a href="http://guides.micronaut.io/micronaut-security-jwt-cookie/guide/index.html">Micronaut JWT Authentication with Cookies</a> to learn more.
</td>
</tr>
</table>
</div>


<h2 id="jwtGenerator">4.3.2 JWT Token Generation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/master/src/main/docs/guide/authenticationStrategies/jwt/jwtGenerator.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut relies on <a href="https://connect2id.com/products/nimbus-jose-jwt">Nimbus JOSE + JWT</a> library to provide JWT token signature and encryption.</p>
</div>
<div class="paragraph">
<p>The following configuration options are available:</p>
</div>
<div class="paragraph">
<p>Unresolved directive in &lt;stdin&gt; - include::/home/travis/build/micronaut-projects/micronaut-security/build/generated/configurationProperties/io.micronaut.security.token.jwt.generator.JwtGeneratorConfigurationProperties.adoc[]</p>
</div>


<h2 id="jwtGeneratorSignature">4.3.2.1 JWT Signature</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/master/src/main/docs/guide/authenticationStrategies/jwt/jwtGenerator/jwtGeneratorSignature.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut security capabilities use signed JWT’s as specified by the
<a href="https://tools.ietf.org/html/rfc7515">JSON Web Signature</a> specification.</p>
</div>
<div class="paragraph">
<p>To enable a JWT signature in token generation, you need to have in your app a bean of type <a href="../api/io/micronaut/security/token/jwt/signature/rsa/RSASignatureGeneratorConfiguration.html">RSASignatureGeneratorConfiguration</a>,
<a href="../api/io/micronaut/security/token/jwt/signature/ec/ECSignatureGeneratorConfiguration.html">ECSignatureGeneratorConfiguration</a>,
<a href="../api/io/micronaut/security/token/jwt/signature/secret/SecretSignatureConfiguration.html">SecretSignatureConfiguration</a> qualified with name <code>generator</code>.</p>
</div>
<div class="paragraph">
<p>To verify signed JWT tokens, you need to have in your app a bean of type <a href="../api/io/micronaut/security/token/jwt/signature/rsa/RSASignatureConfiguration.html">RSASignatureConfiguration</a>,
<a href="../api/io/micronaut/security/token/jwt/signature/rsa/RSASignatureGeneratorConfiguration.html">RSASignatureGeneratorConfiguration</a>,
<a href="../api/io/micronaut/security/token/jwt/signature/ec/ECSignatureGeneratorConfiguration.html">ECSignatureGeneratorConfiguration</a>,
<a href="../api/io/micronaut/security/token/jwt/signature/ec/ECSignatureConfiguration.html">ECSignatureConfiguration</a>, or
<a href="../api/io/micronaut/security/token/jwt/signature/secret/SecretSignatureConfiguration.html">SecretSignatureConfiguration</a>.</p>
</div>
<div class="paragraph">
<p>You can setup a <code>SecretSignatureConfiguration</code> named <code>generator</code> easily via configuration properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">Unresolved directive in &lt;stdin&gt; - include::{testssecurityjwt}/signandencrypt/SignSecretEncryptRSASpec.groovy[indent=0, tag=yamlconfig]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><strong>Change this for your own secret and keep it safe</strong>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Json Web Token Signature name. In this example, HMAC using SHA-256 hash algorithm.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can supply the secret with Base64 encoding.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">Unresolved directive in &lt;stdin&gt; - include::{testssecurityjwt}/base64/JwtBase64Spec.groovy[indent=0, tag=yamlconfig]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Secret Base64 encoded</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Signal that the secret is Base64 encoded</td>
</tr>
</table>
</div>


<h2 id="jwtGeneratorEncryption">4.3.2.2 Encrypted JWTs</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/master/src/main/docs/guide/authenticationStrategies/jwt/jwtGenerator/jwtGeneratorEncryption.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Signed claims prevents an attacker to tamper its contents to introduce malicious data or try a privilege escalation by adding more roles. However, the claims can be decoded just by using Base 64.</p>
</div>
<div class="paragraph">
<p>If the claims contains sensitive information, you can use a JSON Web Encryption algorithm to prevent them to be decoded.</p>
</div>
<div class="paragraph">
<p>To enable a JWT encryption in token generation, you need to have in your app a bean of type  <a href="../api/io/micronaut/security/token/jwt/encryption/rsa/RSAEncryptionConfiguration.html">RSAEncryptionConfiguration</a>,
<a href="../api/io/micronaut/security/token/jwt/encryption/ec/ECEncryptionConfiguration.html">ECEncryptionConfiguration</a>,
<a href="../api/io/micronaut/security/token/jwt/encryption/secret/SecretEncryptionConfiguration.html">SecretEncryptionConfiguration</a> qualified with name <code>generator</code>.</p>
</div>
<div class="sect1">
<h2 id="_example_of_jwt_signed_with_secret_and_encrypted_with_rsa">Example of JWT Signed with Secret and Encrypted with RSA</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Setup a <a href="../api/io/micronaut/security/token/jwt/signature/secret/SecretSignatureConfiguration.html">SecretSignatureConfiguration</a> through configuration properties</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">Unresolved directive in &lt;stdin&gt; - include::{testssecurityjwt}/signandencrypt/SignSecretEncryptRSASpec.groovy[indent=0, tag=yamlconfig]
pem:
  path: /home/user/rsa-2048bit-key-pair.pem <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Name the Signature configuration <code>generator</code> to make it participate in JWT token generation.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Location of PEM file</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Generate a 2048-bit RSA private + public key pair:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">openssl genrsa -out rsa-2048bit-key-pair.pem 2048</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">Unresolved directive in &lt;stdin&gt; - include::{testssecurityjwt}/signandencrypt/RSAOAEPEncryptionConfiguration.groovy[indent=0, tag=clazz]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Name Bean <code>generator</code> to designate this bean as participant in the JWT Token Generation.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To parse the PEM key, use a collaborator as described in <a href="https://connect2id.com/products/nimbus-jose-jwt/openssl-key-generation">OpenSSL key generation</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">Unresolved directive in &lt;stdin&gt; - include::{testssecurityjwt}/signandencrypt/KeyPairProvider.groovy[indent=0, tag=clazz]</code></pre>
</div>
</div>
</div>
</div>


<h2 id="jwtValidation">4.3.3 JWT Token Validation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/master/src/main/docs/guide/authenticationStrategies/jwt/jwtValidation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut&#8217;s JWT validation support multiple Signature and Encryption configurations.</p>
</div>
<div class="paragraph">
<p>Any beans of type <a href="../api/io/micronaut/security/token/jwt/signature/rsa/RSASignatureConfiguration.html">RSASignatureConfiguration</a>,
<a href="../api/io/micronaut/security/token/jwt/signature/ec/ECSignatureConfiguration.html">ECSignatureConfiguration</a>,
<a href="../api/io/micronaut/security/token/jwt/signature/secret/SecretSignatureConfiguration.html">SecretSignatureConfiguration</a>
participate as signature configurations in the JWT validation.</p>
</div>
<div class="paragraph">
<p>Any beans of type <a href="../api/io/micronaut/security/token/jwt/encryption/rsa/RSAEncryptionConfiguration.html">RSAEncryptionConfiguration</a>,
<a href="../api/io/micronaut/security/token/jwt/encryption/ec/ECEncryptionConfiguration.html">ECEncryptionConfiguration</a>,
<a href="../api/io/micronaut/security/token/jwt/encryption/secret/SecretEncryptionConfiguration.html">SecretEncryptionConfiguration</a> participate as encryption configurations in the JWT validation.</p>
</div>


<h2 id="jwks">4.3.3.1 Validation with remote JWKS</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/master/src/main/docs/guide/authenticationStrategies/jwt/jwtValidation/jwks.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A <a href="https://tools.ietf.org/html/rfc7517">JSON Web Key (JWK)</a> is a JSON object that represents a cryptographic key. You can use a remote JWK Set, A JSON object that represents a set of JWKs, to validate JWT signatures.</p>
</div>
<div class="paragraph">
<p>You can configure a remote JWKS as a signature validator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">Unresolved directive in &lt;stdin&gt; - include::{testssecurityjwt}/jwks/JwksSpec.groovy[indent=0, tag=yamlconfig]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous snippet creates a <a href="../api/io/micronaut/security/token/jwt/signature/jwks/JwksSignature.html">JwksSignature</a> bean with a <code>awscognito</code> name qualifier.</p>
</div>
<div class="paragraph">
<p>If you want to expose your own JWK Set, read the <a href="#keys">Keys Controller</a> section.</p>
</div>


<h2 id="claimsGeneration">4.3.4 Claims Generation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/master/src/main/docs/guide/authenticationStrategies/jwt/claimsGeneration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If the built-in
<a href="../api/io/micronaut/security/token/jwt/generator/claims/JWTClaimsSetGenerator.html">JWTClaimsSetGenerator</a>, does not
fulfil your needs you can provide your own <a href="#replaces">replacement</a> of <a href="../api/io/micronaut/security/token/jwt/generator/claims/ClaimsGenerator.html">ClaimsGenerator</a>.</p>
</div>
<div class="paragraph">
<p>For example, if you want to add the email address of the user to the JWT Claims you could create a class which extends <code>UserDetails</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Unresolved directive in &lt;stdin&gt; - include::{testssecurityjwt}/jwtclaimsoverride/EmailUserDetails.java[indent=0, tag=clazz]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Configure your <code>AuthenticationProvider</code> to respond such a class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Unresolved directive in &lt;stdin&gt; - include::{testssecurityjwt}/jwtclaimsoverride/CustomAuthenticationProvider.java[indent=0, tag=clazz]</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then replace <code>JWTClaimsSetGenerator</code> with a bean that overrides the method <code>populateWithUserDetails</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Unresolved directive in &lt;stdin&gt; - include::{testssecurityjwt}/jwtclaimsoverride/CustomJWTClaimsSetGenerator.java[indent=0, tag=clazz]</code></pre>
</div>
</div>


<h2 id="render">4.3.5 Token Render</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/master/src/main/docs/guide/authenticationStrategies/jwt/render.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When you use JWT authentication and the built-in <a href="#login">LoginController</a>,
the JWT tokens are returned to the client as part of an OAuth 2.0 <a href="https://tools.ietf.org/html/RFC6749">RFC6749</a> access token response.</p>
</div>
<div class="paragraph">
<p>An example of such a response is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">HTTP/1.1 200 OK
Content-Type: application/json;charset=UTF-8
Cache-Control: no-store
Pragma: no-cache
{
    "access_token":"eyJhbGciOiJIUzI1NiJ9...",
    "token_type":"Bearer",
    "expires_in":3600,
    "refresh_token":"tGzv3JOkF0XG5Qx2TlKWIA...",
    "username": "euler",
    "roles": [
        "ROLE_USER"
    ],
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you wish to customize the previous JSON payload, you may want to provide a bean replacement for <a href="../api/io/micronaut/security/token/jwt/render/BearerTokenRenderer.html">BearerTokenRenderer</a>. If that is not enough, check the <a href="../api/io/micronaut/security/token/jwt/bearer/AccessRefreshTokenLoginHandler.html">AccessRefreshTokenLoginHandler</a> to accommodate it to your needs.</p>
</div>


<h2 id="ldap">4.4 LDAP Authentication</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/master/src/main/docs/guide/ldap.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports authentication with LDAP out of the box. To get started, add the <code>security-ldap</code> dependency to your application.</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">compile "io.micronaut.configuration:micronaut-security-ldap"</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Read the <a href="http://guides.micronaut.io/micronaut-database-authentication-provider-groovy/guide/index.html#securityLdap">LDAP and Database authentication providers</a> to see an example.
</td>
</tr>
</table>
</div>


<h2 id="configuration">4.4.1 Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/master/src/main/docs/guide/authenticationStrategies/ldap/configuration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The LDAP authentication in Micronaut supports configuration of one or more LDAP servers to authenticate with. Each server has it&#8217;s own settings and can be enabled or disabled.</p>
</div>
<div class="paragraph">
<p>Unresolved directive in &lt;stdin&gt; - include::/home/travis/build/micronaut-projects/micronaut-security/build/generated/configurationProperties/io.micronaut.configuration.security.ldap.configuration.LdapConfiguration.adoc[]
Unresolved directive in &lt;stdin&gt; - include::/home/travis/build/micronaut-projects/micronaut-security/build/generated/configurationProperties/io.micronaut.configuration.security.ldap.configuration.LdapConfiguration$ContextConfiguration.adoc[]
Unresolved directive in &lt;stdin&gt; - include::/home/travis/build/micronaut-projects/micronaut-security/build/generated/configurationProperties/io.micronaut.configuration.security.ldap.configuration.LdapConfiguration$SearchConfiguration.adoc[]
Unresolved directive in &lt;stdin&gt; - include::/home/travis/build/micronaut-projects/micronaut-security/build/generated/configurationProperties/io.micronaut.configuration.security.ldap.configuration.LdapConfiguration$GroupConfiguration.adoc[]</p>
</div>


<h2 id="extending">4.4.2 Extending Default Behavior</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/master/src/main/docs/guide/authenticationStrategies/ldap/extending.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>This section will outline some common requirements that will require custom code to implement and describe what to do in those cases.</p>
</div>
<div class="sect1">
<h2 id="_authentication_data">Authentication Data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The authentication object returned from a successful authentication request is by default an instance of UserDetails, which only contains the username and any roles associated with the user. To store additional data in the authentication, extend <a href="../api/io/micronaut/security/authentication/UserDetails.html">UserDetails</a> with your own implementation that has fields for the additional data you wish to store.</p>
</div>
<div class="paragraph">
<p>To use this new implementation, you must override the <a href="../api/io/micronaut/security/ldap/DefaultContextAuthenticationMapper.html">DefaultContextAuthenticationMapper</a> and provide your own implementation.</p>
</div>
<div class="listingblock">
<div class="title">MyContextAuthenticationMapper.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
@Replaces(DefaultContextAuthenticationMapper.class) <i class="conum" data-value="1"></i><b>(1)</b>
public class MyContextAuthenticationMapper implements ContextAuthenticationMapper {

    @Override
    public AuthenticationResponse map(ConvertibleValues&lt;Object&gt; attributes, String username, Set&lt;String&gt; groups) {
        // return an extended UserDetails or an AuthenticationFailed object
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The usage of @Replaces will allow your bean to replace the default implementation in the context</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_groups">Groups</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default the groups found in LDAP, if enabled, will be returned as is without any processing. No additional groups from any other sources will be added to the list. It is a common requirement to retrieve additional groups from other sources, or to normalize the names of the groups in a specific format.</p>
</div>
<div class="paragraph">
<p>To extend this behavior, it is necessary to create your own implementation of <a href="../api/io/micronaut/security/ldap/group/LdapGroupProcessor.html">LdapGroupProcessor</a>. Likely it will be desired to extend the default implementation because it has the logic for querying the groups from LDAP and executes the other methods to process the groups and query for additional groups.</p>
</div>
<div class="listingblock">
<div class="title">MyLdapGroupProcessor.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
@Replaces(DefaultLdapGroupProcessor.class) <i class="conum" data-value="1"></i><b>(1)</b>
public class MyLdapGroupProcessor extends DefaultLdapGroupProcessor {

    Set&lt;String&gt; getAdditionalGroups(LdapSearchResult result) { <i class="conum" data-value="2"></i><b>(2)</b>
        //Use the result to query another source for additional groups (database, etc)
    }

    Optional&lt;String&gt; processGroup(String group) { <i class="conum" data-value="3"></i><b>(3)</b>
        //convert "Admin" to "ROLE_ADMIN" for example
        //return an empty optional to exclude the group
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The usage of @Replaces will allow your bean to replace the default implementation in the context</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/security/ldap/group/LdapGroupProcessor.html#getAdditionalGroups-io.micronaut.security.ldap.context.LdapSearchResult-">getAdditionalGroups</a> method allows you to add groups from other sources</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="../api/io/micronaut/security/ldap/group/LdapGroupProcessor.html#processGroup-java.lang.String-">processGroup</a> method allows you to transform the name of the group, or exclude it</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_search_logic">Search Logic</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To customize how LDAP searches are done, replace the default implementation with your own. See <a href="../api/io/micronaut/security/ldap/context/LdapSearchService.html">LdapSearchService</a>.</p>
</div>
<div class="listingblock">
<div class="title">MyLdapSearchService.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
@Replaces(DefaultLdapSearchService.class)
public class MyLdapSearchService implements LdapSearchService {

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_context_building">Context Building</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To customize how the LDAP context is built, replace the default implementation with your own. See <a href="../api/io/micronaut/security/ldap/context/ContextBuilder.html">ContextBuilder</a>.</p>
</div>
<div class="listingblock">
<div class="title">MyContextBuilder.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
@Replaces(DefaultContextBuilder.class)
public class MyContextBuilder implements ContextBuilder {

}</code></pre>
</div>
</div>
</div>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/securityRule.html">&lt;&lt; <strong>3</strong><span>Security Rules</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/rejection.html"><strong>5</strong><span>Rejection Handling</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
